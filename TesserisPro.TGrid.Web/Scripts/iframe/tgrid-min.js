//!=====================================================================================
//!
//! The Tesseris Free License
//!
//! Copyright(c) 2014 Tesseris Pro LLC
//!
//! Permission is hereby granted, free of charge, to any person obtaining a copy of this 
//! software and associated documentation files(the "Software"), to deal in the Software 
//! without restriction, including without limitation the rights to use, copy, modify,
//! merge, publish, distribute, sublicense, and / or sell copies of the Software, and to 
//! permit persons to whom the Software is furnished to do so, subject to the following
//! conditions:
//!
//! 1. The above copyright notice and this permission notice shall be included in all 
//!    copies or substantial portions of the Software.
//!
//! 2. Any software that fully or partially contains or uses materials covered by 
//!    this license shall notify users about this notice and above copyright.The 
//!    notification can be made in "About box" and / or site main web - page footer.The 
//!    notification shall contain name of Tesseris Pro company and name of the Software 
//!    covered by current license.
//!
//! THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, 
//! INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A 
//! PARTICULAR PURPOSE AND NONINFRINGEMENT.IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT 
//! HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION 
//! OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE 
//! SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//!
//!=====================================================================================
function isNull(n){return n==null}function isNotNull(n){return n!=null}function isUndefined(n){return typeof n=="undefined"}function isNotUndefined(n){return typeof n!="undefined"}function isNoU(n){return isUndefined(n)||isNull(n)}function isNotNoU(n){return isNotUndefined(n)&&isNotNull(n)}function isFunction(n){return n&&{}.toString.call(n)==="[object Function]"}function isObservable(n){return n&&{}.toString.call(n)==="[object Function]"}function insertAfter(n,t){var i=n.parentNode,r=n.nextSibling;return r?i.insertBefore(t,r):i.appendChild(t)}function insertBefore(n,t){var i=n.parentNode;return i.insertBefore(t,n)}function getMemberValue(n,t){if(t==null||t.length==0)return n;for(var i=t.split("."),r=n;i.length>0;)r=r[i[0]],i.splice(0,1);return r}function hideElement(n){n.style.display="none"}function unhideElement(n){n.style.display=""}function addClass(n,t){var i=n.getAttribute("class"),r;r=i!=null&&i.length>0?i.indexOf(t)==-1?i.concat(" ").concat(t):i:t;n.setAttribute("class",r)}function removeClass(n,t){var u=n.getAttribute("class"),r,i,f;if(u!=null&&u.length>0){for(r=u.split(" "),i=0;i<r.length;i++)r[i]==t&&(r.splice(i,1),i--);f=r.join(" ");n.setAttribute("class",f)}}function containsClass(n,t){if(n!=null){var i=n.getAttribute("class");return i!=null&&i.indexOf(t)!=-1?!0:!1}}var TesserisPro;(function(n){(function(t){var i=function(){function i(){}return i.prototype.getTableElement=function(){var n=document.createElement("table");return n.className="tgrid-table",n},i.prototype.bindData=function(){},i.prototype.getElementsSize=function(){return 0},i.prototype.getFirstVisibleItem=function(){return null},i.prototype.getVisibleItemsCount=function(n,t,i,r){for(var u,e=0,o=0,s=n.children,h=0,f=0;f<s.length;f++)if(u=s.item(f),u.style.display!="none"&&u.style.visibility!="hidden"&&(e+=u.offsetHeight,e>i&&(r&&containsClass(u,"tgrid-table-group-header")||o++,h+=u.offsetHeight)),h>=t.clientHeight)break;return o},i.prototype.getFooterViewModel=function(){},i.prototype.getFilterPopupViewModel=function(){},i.prototype.updateTableHeadElement=function(){},i.prototype.updateTableBodyElement=function(n,t){return t},i.prototype.updateTableFooterElement=function(){},i.prototype.updateGroupedTableBodyElement=function(){},i.prototype.updateColumnWidth=function(n,t,i){var f,s,r,a,l,c,u,e,h,o,v;if(!n.hideHeader){for(f=t.getElementsByTagName("th"),s=!1,u=0;u<n.columns.length;u++)n.columns[u].notSized&&!n.enablePaging&&(s=!0);for(h=s?f.length-1:f.length,r=0;r<n.columns.length&&n.columns[r].device.indexOf("desktop")==-1;)r++;for(u=0;u<h;u++){while(r<n.columns.length&&n.columns[r].device.indexOf("desktop")==-1)r++;if(r>=n.columns.length){r=n.columns.length-1;break}n.columns[r].notSized||(f.item(u+n.columns.length).style.width=n.columns[r].width.toString()+"px",a=f.item(u+n.columns.length).getElementsByClassName("tgrid-header-cell-container").item(0),a.style.width=n.columns[r].width.toString()+"px");r++}}for(c=i.getElementsByTagName("tr"),u=0;u<c.length;u++)if(containsClass(c.item(u),"tgrid-table-body-row")&&(l=c.item(u),l!=undefined))for(e=l.getElementsByClassName("tgrid-table-data-cell"),h=s?e.length-1:e.length,r=0,o=0;o<h;o++){while(r<n.columns.length&&n.columns[r].device.indexOf("desktop")==-1)r++;if(r>=n.columns.length){r=n.columns.length-1;break}n.columns[r].notSized||(e.item(o).style.width=n.columns[r].width.toString()+"px",v=e.item(o).firstChild,v.style.width=n.columns[r].width.toString()+"px");r++}},i.prototype.buildDefaultTableFooterElement=function(n,t,i){var e=n.currentPage-n.pageSlide,u,o,f,s,r;for(e<0&&(e=0),u=n.currentPage+n.pageSlide,o=Math.ceil(i/n.pageSize),u>=o&&(u=o-1),f=document.createElement("div"),f.setAttribute("class","tgrid-pagination"),e>0&&(f.innerHTML+="<span class='tgrid-page-number' onclick='TesserisPro.TGrid.Grid.getGridObject(event.target).selectPage("+(e-1).toString()+")' >...<\/span>"),r=e;r<=u;r++)f.innerHTML+=n.currentPage==r?"<span class='tgrid-page-current'>"+(r+1)+"<\/span>":"<span class='tgrid-page-number' onclick='TesserisPro.TGrid.Grid.getGridObject(event.target).selectPage("+r+")' >"+(r+1)+"<\/span>";for(u<o-1&&(f.innerHTML+="<span class='tgrid-page-number' onclick='TesserisPro.TGrid.Grid.getGridObject(event.target).selectPage("+u.toString()+")' >...<\/span>"),s=t.getElementsByClassName("tgrid-pagination"),r=0;r<s.length;r++)t.removeChild(s[r]);t.appendChild(f)},i.prototype.getActualDetailsTemplate=function(n){return n.showDetailFor.item==null?null:n.showDetailFor.column==-1?n.detailsTemplateHtml:n.columns[n.showDetailFor.column].cellDetail},i.prototype.updateTableDetailRow=function(){},i.prototype.updateMobileDetailRow=function(){},i.prototype.buildDefaultHeader=function(n,t){var i=document.createElement("span"),r=document.createTextNode(t);i.appendChild(r);n.appendChild(i)},i.prototype.onCloseFilterPopup=function(){document.onclick=i.oldOnClick},i.prototype.updateGroupByPanel=function(n,t){var r,i,u;t.innerHTML="";n.enableGrouping&&(this.addActualGroupByElements(n,t),r=document.createElement("div"),r.setAttribute("class","tgrid-goup-button"),i=document.createElement("ul"),i.setAttribute("class","tgrid-menu"),hideElement(i),u=this,r.onclick=function(t){t.cancelBubble=!0;u.updateGroupByMenuContent(n,i);unhideElement(i);u.doOnClickOutside(i,function(){return hideElement(i)})},r.appendChild(i),t.appendChild(r))},i.prototype.showNeededIndents=function(n,t){for(var u=t,r=n.getElementsByClassName("tgrid-table-indent-cell"),i=0;i<r.length;i++)hideElement(r[i]);for(r.length<t&&(u=r.length),i=0;i<u;i++)unhideElement(r[i])},i.prototype.updateFilteringPopUp=function(){},i.prototype.addActualGroupByElements=function(n,i){for(var e,o,u,h,s,f,r=0;r<n.groupBySortDescriptors.length;r++)for(e=0;e<n.columns.length;e++)n.columns[e].device.indexOf("desktop")!=-1&&(o=n.columns[e],o.groupMemberPath==n.groupBySortDescriptors[r].path&&o.groupMemberPath!=null&&(u=document.createElement("div"),h=this.buildColumnHeader(o),this.bindData(n,h),u.className="tgrid-group-by-element",u["data-group-by"]=o.groupMemberPath,u.appendChild(h),s=document.createElement("div"),s.className="tgrid-header-cell-buttons",f=document.createElement("div"),f.className="tgrid-delete-button",f["data-delete-group-by"]=n.groupBySortDescriptors[r],f["data-delete-group-by-number"]=r,f.onclick=function(n){n.cancelBubble=!0;t.Grid.getGridObject(n.target).removeGroupDescriptor(n.target["data-delete-group-by"].path)},s.appendChild(f),u.appendChild(s),i.appendChild(u)))},i.prototype.updateGroupByMenuContent=function(n,i){var r,e,f,u,o;for(i.innerHTML="",r=0;r<n.columns.length;r++)if(n.columns[r].device.indexOf("desktop")!=-1&&n.columns[r].enableGrouping&&n.columns[r].groupMemberPath!=null){for(e=!1,f=0;f<n.groupBySortDescriptors.length;f++)n.groupBySortDescriptors[f].path==n.columns[r].groupMemberPath&&(e=!0);e||(u=document.createElement("li"),u["data-group-by-path"]=n.columns[r].groupMemberPath,o=this.buildColumnHeader(n.columns[r]),this.bindData(n,o),u.appendChild(o),u.onclick=function(n){hideElement(i);t.Grid.getGridObject(n.target).addGroupDescriptor(n.currentTarget["data-group-by-path"],!0)},i.appendChild(u))}},i.prototype.buildGroupMobileHeaderRow=function(t,i){var r=document.createElement("div"),u=document.createElement("div"),f;for(addClass(r,"tgrid-mobile-group-header"),f=0;f<i.level;f++)r.innerHTML+="<div class='tgrid-mobile-group-indent-div'><\/div>";return t.enableCollapsing&&(addClass(r,"collapsing"),r.onclick=i.collapse?function(t){n.TGrid.Grid.getGridObject(t.target).removeCollapsedFilters(i.filterDescriptor)}:function(t){n.TGrid.Grid.getGridObject(t.target).setCollapsedFilters(i.filterDescriptor)}),t.groupHeaderTemplate!=null?t.groupHeaderTemplate.applyTemplate(u):this.createDefaultGroupHeader(u),addClass(u,"tgrid-mobile-group-header-container"),this.bindMobileGroupHeader(r,i.value,u),r},i.prototype.bindMobileGroupHeader=function(n,t,i){n.appendChild(i)},i.prototype.createDefaultGroupHeader=function(){},i.prototype.addFilterButton=function(n,i,r,u,f){for(var h,e=document.createElement("div"),s=!1,o=0;o<n.filterDescriptor.children.length;o++)n.filterDescriptor.children[o].path==n.columns[f].filterMemberPath&&(s=!0);s?addClass(e,"tgrid-filter-button-active"):addClass(e,"tgrid-filter-button");h=this,function(u){e.onclick=function(f){var o=f.target,e=t.Grid.getGridObject(o),c=i.getBoundingClientRect().bottom-e.GetRootElement().getBoundingClientRect().top,s=o.getBoundingClientRect().left-e.GetRootElement().getBoundingClientRect().left;r.style.display=="none"||n.filterPopupForColumn!=n.columns[u]?(e.showFilterPopup(n.columns[u],s,c,!0),s+r.offsetWidth>i.getBoundingClientRect().right-e.GetRootElement().getBoundingClientRect().left&&e.showFilterPopup(n.columns[u],s-r.offsetWidth+o.offsetWidth,c,!0)):e.hideFilterPopup();h.doOnClickOutside(r,function(){var n=t.Grid.getGridObject(o);n!=null&&n.hideFilterPopup()});f.cancelBubble=!0}}(f);u.appendChild(e)},i.prototype.updateMobileHeadElement=function(n,t,i){t.innerHTML="";(n.enableSorting||n.enableGrouping||n.enableFiltering)&&this.createMobileButton(n,t,i)},i.prototype.updateMobileItemsList=function(){},i.prototype.createMobileButton=function(n,t,i){var f=this,r=document.createElement("div"),u;r.className=this.anyConditionIsApplied(n)?"tgrid-mobile-button-active":"tgrid-mobile-button";u=this;r.onclick=function(t){var e=document.createElement("ul");e.className="tgrid-mobile-menu";f.addMobileMenuItems(n,e,i);r.innerHTML="";r.appendChild(e);u.doOnClickOutside(e,function(){hideElement(e)});t.cancelBubble=!0};t.appendChild(r)},i.prototype.addMobileMenuItems=function(n,i,r){for(var u,l,v,a,h,c,o,y,w,s,p,f,e=0;e<n.columns.length;e++)if(u=n.columns[e],u.member!=null||u.sortMemberPath!=null||u.filterMemberPath!=null||u.groupMemberPath!=null){if(l=document.createElement("li"),v=this.buildMobileMenuColumnHeader(u),this.bindData(n,v),a=document.createElement("div"),a.className="tgrid-mobile-li-header-container",a.appendChild(v),h=document.createElement("div"),h.className="tgrid-header-cell-buttons",n.enableSorting&&u.sortMemberPath!=null&&(c=document.createElement("div"),n.columns[e].enableSorting?(c.className=u.sortMemberPath==n.sortDescriptor.path?n.sortDescriptor.asc==null?"tgrid-sort-button":n.sortDescriptor.asc?"tgrid-sort-button-asc":"tgrid-sort-button-desc":"tgrid-sort-button",c.onclick=function(n){n.cancelBubble=!0;hideElement(i);t.Grid.getGridObject(n.target).sortBy(n.target["data-g-path"])}):addClass(c,"tgrid-mobile-sort-button-inactive"),h.appendChild(c),c["data-g-path"]=u.sortMemberPath),n.enableFiltering&&u.filterMemberPath!=null){if(o=document.createElement("div"),y=!1,n.columns[e].enableFiltering){for(f=0;f<n.filterDescriptor.children.length;f++)if(n.filterDescriptor.children[f].path==u.filterMemberPath){o.className="tgrid-mobile-filter-button-active";y=!0;break}y||(o.className="tgrid-mobile-filter-button");w=this;o.onclick=function(n){n.cancelBubble=!0;hideElement(i);w.doOnClickOutside(r,function(){hideElement(r)});t.Grid.getGridObject(n.target).showFilterPopup(n.target["data-g-column"],n.pageX,n.pageY,!1)}}else addClass(o,"tgrid-mobile-filter-button-inactive");h.appendChild(o);o["data-g-column"]=u}if(n.enableGrouping&&u.groupMemberPath!=null){if(s=document.createElement("div"),p=!1,n.columns[e].enableGrouping){for(f=0;f<n.groupBySortDescriptors.length;f++)if(n.groupBySortDescriptors[f].path==u.groupMemberPath){s.className="tgrid-group-button-active";p=!0;break}p||(s.className="tgrid-group-button");s.onclick=function(n){n.cancelBubble=!0;hideElement(i);var r=t.Grid.getGridObject(n.target);r.toggleGroupDescriptor(n.target["data-g-path"])}}else addClass(s,"tgrid-mobile-group-button-inactive");h.appendChild(s);s["data-g-path"]=u.groupMemberPath}l.appendChild(a);l.appendChild(h);i.appendChild(l)}},i.prototype.doOnClickOutside=function(n,t){var i=function(r){for(var u=r.target;u!=null&&u.tagName!="BODY";){if(u==n)return;u=u.parentElement}document.removeEventListener("click",i);t()};document.addEventListener("click",i)},i.prototype.appendIndent=function(n,t,i){for(var r,u,e=i?"th":"td",f=0;f<t;f++)r=document.createElement(e),r.className="tgrid-table-indent-cell",u=document.createElement("div"),u.className="tgrid-table-indent-cell-content",r.appendChild(u),n.appendChild(r)},i.prototype.buildColumnHeader=function(n){var t=document.createElement("div"),i;return t.className="tgrid-header-cell-content",n.header!=null?n.header.applyTemplate(t):(i=n.member!=null?n.member:"",this.buildDefaultHeader(t,i)),t},i.prototype.buildMobileMenuColumnHeader=function(n){var t=document.createElement("div"),i;return t.className="tgrid-mobile-menu-li-column-header",n.header!=null?n.header.applyTemplate(t):(i=n.member!=null?n.member:"",this.buildDefaultHeader(t,i)),t},i.prototype.anyConditionIsApplied=function(n){return n.sortDescriptor.path!=null||n.groupBySortDescriptors.length>0&&n.groupBySortDescriptors[0].path!=null||n.filterDescriptor.children.length>0||n.filterDescriptor.condition!=0?!0:!1},i.prototype.detachDocumentClickEvent=function(){document.onclick=i.oldOnClick},i.oldOnClick=document.onclick,i}();t.BaseHtmlProvider=i})(n.TGrid||(n.TGrid={}));var t=n.TGrid})(TesserisPro||(TesserisPro={})),function(n){(function(n){var t=function(){function n(n,t,i,r,u,f){this.path=n;this.value=t;this.condition=i;this.children=f!=undefined?f:[];this.childrenUnionOperator=u!=undefined?u:0;this.parentChildUnionOperator=r!=undefined?r:0}return n.prototype.addChild=function(n){this.children.push(n)},n.prototype.removeChildByPath=function(n){for(var t=0;t<this.children.length;t++)if(this.children[t].path==n){this.children.splice(t,1);return}},n.getEmpty=function(){return new n("","",0)},n}();n.FilterDescriptor=t})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={})),function(n){(function(n){var t=function(){function n(n,t,i,r){this.collapse=i;this.value=n;this.level=t;this.filterDescriptor=r}return n}();n.GroupHeaderDescriptor=t})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={})),function(n){(function(n){var t=function(){function t(n,t,i,r){this.model=n;this.item=t;this.grid=i;this.isGroupHeader=r}return t.prototype.toggleDetailsForCell=function(n){this.grid.options.showCustomDetailFor.item!=this.item||this.grid.options.showCustomDetailFor.item==this.item&&this.grid.options.showDetailFor.column!=n?this.openDetailsForCell(n):this.closeDetailsForCell(n)},t.prototype.openDetailsForCell=function(n){this.grid.options.showDetailFor.column=n;this.grid.options.showDetailFor.item=this.item;this.grid.updateRow(this.item,!0);this.grid.options.showCustomDetailFor.item=this.item;this.grid.options.showCustomDetailFor.column=n;this.grid.options.shouldAddDetailsOnSelection=!1},t.prototype.closeDetailsForCell=function(){this.grid.options.showCustomDetailFor.item==this.item&&(this.grid.options.showDetailFor=new n.ShowDetail,this.grid.updateRow(this.item,!1),this.grid.options.showCustomDetailFor=new n.ShowDetail)},t.prototype.setItemValue=function(n){this.item=n},t}();n.ItemViewModel=t})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={})),function(n){(function(t){var e,o,s,h,r,u,i,f;(function(n){n[n.Knockout=0]="Knockout";n[n.Angular=1]="Angular"})(t.Framework||(t.Framework={}));e=t.Framework,function(n){n[n.None=0]="None";n[n.Single=1]="Single";n[n.Multi=2]="Multi"}(t.SelectionMode||(t.SelectionMode={}));o=t.SelectionMode,function(n){n[n.None=0]="None";n[n.Equals=1]="Equals";n[n.NotEquals=2]="NotEquals"}(t.FilterCondition||(t.FilterCondition={}));s=t.FilterCondition,function(n){n[n.And=0]="And";n[n.Or=1]="Or"}(t.LogicalOperator||(t.LogicalOperator={}));h=t.LogicalOperator;r=function(){function n(){this.header=null;this.cell=null;this.cellDetail=null;this.width="150";this.device="mobile,desktop";this.sortMemberPath=null;this.groupMemberPath=null;this.member=null;this.resizable=!0;this.filterMemberPath=null;this.notSized=!1;this.enableFiltering=!0;this.enableSorting=!0;this.enableGrouping=!0}return n}();t.ColumnInfo=r;u=function(){function n(){this.column=-1;this.item=null}return n}();t.ShowDetail=u;i=function(){function n(n){this.content="";this.content=n.innerHTML==null?n.innerText:n.innerHTML}return n.prototype.applyTemplate=function(n){n.innerHTML=this.content!=null?this.content:""},n.prototype.getContent=function(){return this.content},n}();t.Template=i;f=function(){function f(n,i){this.columns=[];this.mobileTemplateHtml=null;this.detailsTemplateHtml=null;this.groupHeaderTemplate=null;this.filterPopup=null;this.pageSize=10;this.pageSlide=1;this.batchSize=5;this.firstLoadSize=10;this.currentPage=0;this.groupBySortDescriptors=[];this.selectionMode=1;this.filterDescriptor=t.FilterDescriptor.getEmpty();this.tableFooterTemplate=null;this.selection=[];this.columnMinWidth=5;this.hasAnyNotSizedColumn=!1;this.captureScroll=!0;this.target=n;this.framework=i;this.initialize();this.minItemsCountForVirtualization=100}return f.prototype.isSelected=function(n){for(var t=0;t<this.selection.length;t++)if(this.selection[t]==n)return!0;return!1},f.prototype.initialize=function(){var w,o,t,e,s,h,c,l,a,v,y,p;if(this.target.getElementsByTagName("script").length>0){w=this.target.getElementsByTagName("script")[0].innerHTML;o=document.createElement("div");o.innerHTML=w;var b=o.getElementsByTagName("header"),k=o.getElementsByTagName("cell"),d=o.getElementsByTagName("celldetail"),f=o.getElementsByTagName("column");for(t=0;t<f.length;t++)e=new r,f[t].attributes["data-g-member"]!=undefined&&(e.member=f[t].attributes["data-g-member"].nodeValue),s=f[t].getElementsByTagName("header"),s.length>0&&(e.header=new i(s[0])),h=f[t].getElementsByTagName("cell"),h.length>0&&(e.cell=new i(h[0])),c=f[t].getElementsByTagName("celldetail"),c.length==1&&(e.cellDetail=new i(c[0])),f[t].attributes["data-g-width"]!=null&&(e.width=f[t].attributes["data-g-width"].nodeValue),f[t].attributes["data-g-views"]!=null&&(e.device=f[t].attributes["data-g-views"].nodeValue),f[t].attributes["data-g-resizable"]!=undefined&&(e.resizable=f[t].attributes["data-g-resizable"].nodeValue=="false"?!1:!0),f[t].attributes["data-g-not-sized"]!=undefined&&(e.notSized=f[t].attributes["data-g-not-sized"].nodeValue=="true"?!0:!1,this.hasAnyNotSizedColumn=!0),f[t].attributes["data-g-enable-filtering"]!=undefined&&(e.enableFiltering=f[t].attributes["data-g-enable-filtering"].nodeValue=="false"?!1:!0),f[t].attributes["data-g-enable-sorting"]!=undefined&&(e.enableSorting=f[t].attributes["data-g-enable-sorting"].nodeValue=="false"?!1:!0),f[t].attributes["data-g-enable-grouping"]!=undefined&&(e.enableGrouping=f[t].attributes["data-g-enable-grouping"].nodeValue=="false"?!1:!0),e.sortMemberPath=f[t].attributes["data-g-sort-member"]!=undefined?f[t].attributes["data-g-sort-member"].nodeValue:e.member,e.groupMemberPath=f[t].attributes["data-g-group-member"]!==undefined?f[t].attributes["data-g-group-member"].nodeValue:e.member,e.filterMemberPath=f[t].attributes["data-g-filter-member"]!=undefined?f[t].attributes["data-g-filter-member"].nodeValue:e.member,this.columns.push(e);l=o.getElementsByTagName("filterpopup");l.length==1&&(this.filterPopup=new i(l[0]));a=o.getElementsByTagName("mobile");a.length==1&&(this.mobileTemplateHtml=new i(a[0]));v=o.getElementsByTagName("groupheader");v.length==1&&(this.groupHeaderTemplate=new i(v[0]));y=o.getElementsByTagName("details");y.length==1&&(this.detailsTemplateHtml=new i(y[0]));p=o.getElementsByTagName("footer");p.length!=0&&(this.tableFooterTemplate=new i(p[0]))}this.sortDescriptor=new n.TGrid.SortDescriptor(null,null);this.showDetailFor=new u;this.showCustomDetailFor=new u;this.filterPopupForColumn=new r},f.prototype.applyHandler=function(){for(var n=0;n<this.columns.length;n++)isNotNoU(this.columns[n].member)&&(isNoU(this.columns[n].groupMemberPath)&&(this.columns[n].groupMemberPath=this.columns[n].member),isNoU(this.columns[n].sortMemberPath)&&(this.columns[n].sortMemberPath=this.columns[n].member),isNoU(this.columns[n].filterMemberPath)&&(this.columns[n].sortMemberPath=this.columns[n].member));this.apply()},f}();t.Options=f})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={})),function(n){(function(n){var t=function(){function n(n,t){this.path=n;this.asc=t}return n}();n.SortDescriptor=t})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={})),function(n){(function(n){var t=function(){function t(n,t,i){var r=this;this.isPreloadingNext=!1;this.isPreloadingPrevious=!1;this.enablePreload=!0;this.isBuisy=!1;this.isFirstRefresh=!0;n.grid=this;this.targetElement=n;this.options=t;this.itemProvider=i;this.options.minItemsCountForVirtualization>0&&this.options.enableVirtualScroll?this.itemProvider.getTotalItemsCount(this.options.filterDescriptor,function(n){n<r.options.minItemsCountForVirtualization&&(r.options.enableVirtualScroll=!1);r.initialize()}):this.initialize()}return t.prototype.initialize=function(){var n=this,t,i,r;this.collapsedGroupFilterDescriptors=[];this.itemProvider.onAdd=function(){n.options.enableVirtualScroll||n.options.firstLoadSize++;n.refreshBody()};this.itemProvider.onReset=function(){n.options.enableVirtualScroll||n.itemProvider.getTotalItemsCount(n.options.filterDescriptor,function(t){n.options.firstLoadSize=t});n.refreshBody()};this.itemProvider.onRemove=function(){n.options.enableVirtualScroll||n.options.firstLoadSize--;n.refreshBody()};this.htmlProvider=this.getHtmlProvider(this.options);this.footerViewModel=this.htmlProvider.getFooterViewModel(this);this.rootElement=document.createElement("div");this.rootElement.className="tgrid-root";this.options.hideHeader||(this.groupByElement=document.createElement("div"),this.groupByElement.className="tgrid-group-by-panel desktop",this.rootElement.appendChild(this.groupByElement),this.headerContainer=document.createElement("div"),this.headerContainer.className="tgrid-tableheadercontainer desktop",t=document.createElement("table"),t.className="tgrid-table",this.headerContainer.appendChild(t));this.options.enableFiltering&&(this.filterPopUp=document.createElement("div"),this.filterPopUp.setAttribute("class","tgrid-filter-popup"),this.filterPopUp.style.display="none",this.rootElement.appendChild(this.filterPopUp),this.filterPopupViewModel=this.htmlProvider.getFilterPopupViewModel(this.filterPopUp),this.htmlProvider.updateFilteringPopUp(this.options,this.filterPopUp,this.filterPopupViewModel));this.bodyAndHeaderContainer=document.createElement("div");this.bodyAndHeaderContainer.className="tgrid-body-and-header-container";this.bodyAndHeaderContainer.style.position="relative";this.bodyAndHeaderContainer.style.overflowX="auto";this.bodyAndHeaderContainer.style.width="100%";this.options.hideHeader||(this.mobileHeader=document.createElement("div"),this.mobileHeader.className="tgrid-mobile-header mobile",this.bodyAndHeaderContainer.appendChild(this.mobileHeader),this.tableHeader=document.createElement("thead"),this.tableHeader.setAttribute("class","tgrid-table-header desktop"),t.appendChild(this.tableHeader),this.bodyAndHeaderContainer.appendChild(this.headerContainer));this.tableBodyContainer=document.createElement("div");this.tableBodyContainer.className="tgrid-tablebodycontainer desktop";this.tableBodyContainer.style.overflowX="auto";this.tableBodyContainer.onscroll=this.options.hideHeader?function(){return n.tableBodyContainer.scrollLeft}:function(){return n.headerContainer.scrollLeft=n.tableBodyContainer.scrollLeft};this.mobileContainer=document.createElement("div");this.mobileContainer.setAttribute("class","tgrid-mobile-container mobile");this.options.enableVirtualScroll?(this.tableBodyContainer.onscroll=function(){return n.scrollTable()},this.mobileContainer.onscroll=function(){return n.scrollTable()}):this.itemProvider.getTotalItemsCount(this.options.filterDescriptor,function(t){n.options.firstLoadSize=t});i=document.createElement("table");i.className="tgrid-table";this.tableBodyContainer.appendChild(i);this.tableBody=document.createElement("tbody");i.appendChild(this.tableBody);this.options.enableVirtualScroll&&(this.scrollBar=document.createElement("div"),this.scrollBar.className=this.options.hideHeader?"tgrid-scroll noheader":"tgrid-scroll",this.scrollBar.style.overflowX="hidden",this.scrollBar.style.overflowY="scroll",r=document.createElement("div"),r.style.height="10000px",r.style.width="1px",this.scrollBar.appendChild(r),this.bodyAndHeaderContainer.appendChild(this.scrollBar),this.scrollBar.onscroll=function(){return n.onManualScroll()});this.bodyAndHeaderContainer.appendChild(this.tableBodyContainer);this.bodyAndHeaderContainer.appendChild(this.mobileContainer);this.rootElement.appendChild(this.bodyAndHeaderContainer);this.tableFooter=document.createElement("div");this.tableFooter.setAttribute("class","tgrid-footer");this.rootElement.appendChild(this.tableFooter);this.targetElement.appendChild(this.rootElement);this.tableBodyContainer.scrollTop=0;this.options.groupBySortDescriptors.length>0?(this.refreshHeader(),this.refreshBody(this.options.enableVirtualScroll)):this.sortBy(this.options.sortDescriptor.path);this.refreshFooter();this.buisyIndicator=document.createElement("div");this.buisyIndicator.className="tgrid-buisy-indicator";this.rootElement.appendChild(this.buisyIndicator);this.options.captureScroll&&(this.rootElement.onmousewheel=function(t){return n.mouseWheel(t)});this.rootElement.tabIndex=0;this.rootElement.onkeydown=function(t){return n.keyPress(t)};this.tableBodyContainer.onmousedown=function(n){n.button==1&&n.preventDefault()};this.hideBuisyIndicator()},t.prototype.GetRootElement=function(){return this.rootElement},t.getGridObject=function(n){return n==null?null:n.grid==undefined||n.grid==null?n.parentElement==document.body?null:t.getGridObject(n.parentElement):n.grid},t.prototype.columnsResized=function(n){parseInt(n.width)<this.options.columnMinWidth&&(n.width=this.options.columnMinWidth.toString());this.htmlProvider.updateColumnWidth(this.options,this.tableHeader,this.tableBody,this.tableFooter)},t.prototype.mouseWheel=function(n){n.preventDefault();n.stopImmediatePropagation();n.stopPropagation();this.tableBodyContainer.scrollTop=this.tableBodyContainer.scrollTop-n.wheelDelta;this.mobileContainer.scrollTop=this.mobileContainer.scrollTop-n.wheelDelta},t.prototype.keyPress=function(n){switch(n.keyCode){case 38:n.preventDefault();this.selectPreviousItem();break;case 40:n.preventDefault();this.selectNextItem()}},t.prototype.selectNextItem=function(){var t,i,n;if(this.options.selection.length>0)for(i=this.options.selection[this.options.selection.length-1],n=0;n<this.visibleViewModels.length;n++)if(this.visibleViewModels[n].item==i){while(n<this.visibleViewModels.length-1&&this.visibleViewModels[n+1].isGroupHeader)n++;if(n<this.visibleViewModels.length-1&&!this.visibleViewModels[n+1].isGroupHeader){t=this.visibleViewModels[n+1];break}if(n==this.visibleViewModels.length-1)if(this.visibleViewModels[n].isGroupHeader){while(n>=0&&this.visibleViewModels[n].isGroupHeader)n--;t=this.visibleViewModels[n];break}else{t=this.visibleViewModels[n];break}}t==null&&this.visibleViewModels.length!=0&&(t=this.visibleViewModels[0]);t!=null&&this.selectItem(t,!1)},t.prototype.selectPreviousItem=function(){var t,i,n;if(this.options.selection.length>0)for(i=this.options.selection[this.options.selection.length-1],n=this.visibleViewModels.length-1;n>=0;n--)if(this.visibleViewModels[n].item==i){while(n>0&&this.visibleViewModels[n-1].isGroupHeader)n--;if(n>0&&!this.visibleViewModels[n-1].isGroupHeader){t=this.visibleViewModels[n-1];break}if(n==0)if(this.visibleViewModels[n].isGroupHeader){while(n<this.visibleViewModels.length-1&&this.visibleViewModels[n].isGroupHeader)this.scrollIntoView(this.visibleViewModels[n].item),n++;t=this.visibleViewModels[n];break}else{t=this.visibleViewModels[n];break}}t==null&&this.visibleViewModels.length!=0&&(t=this.visibleViewModels[0]);t!=null&&this.selectItem(t,!1)},t.prototype.getPreviousPageFirsItemIndex=function(){var n=this.firstVisibleItemIndex-this.options.batchSize;return n<0&&(n=0),n},t.prototype.isDesktopMode=function(){return this.tableBodyContainer.clientWidth!=0},t.prototype.getPreviousPageSize=function(){var n=this.options.batchSize,t=this.firstVisibleItemIndex-n;return t<0?n+t:n},t.prototype.getNextPageFirstItemIndex=function(){return this.firstVisibleItemIndex+this.visibleItems.length},t.prototype.getNextPageSize=function(){return this.options.batchSize},t.prototype.getEffectiveSorting=function(){for(var r,i,t=[],u=!1,n=0;n<this.options.groupBySortDescriptors.length;n++){for(r=!1,i=0;i<t.length;i++)if(this.options.sortDescriptor.path==this.options.groupBySortDescriptors[n].path&&(u=!0),t[i].path==this.options.groupBySortDescriptors[n].path){r=!0;break}r||(this.options.groupBySortDescriptors[n].path==this.options.sortDescriptor.path&&(this.options.groupBySortDescriptors[n].asc=this.options.sortDescriptor.asc),t.push(this.options.groupBySortDescriptors[n]))}return u||t.push(this.options.sortDescriptor),t},t.prototype.getEffectiveFiltering=function(){return this.options.filterDescriptor},t.prototype.getCollapsedGroupFilter=function(){return this.collapsedGroupFilterDescriptors},t.prototype.scrollTable=function(){this.isDesktopMode&&!this.options.hideHeader&&(this.headerContainer.scrollLeft=this.tableBodyContainer.scrollLeft);var n=this.isDesktopMode()?this.tableBodyContainer:this.mobileContainer;!this.isPreloadingNext&&this.enablePreload&&n.scrollTop>(n.scrollHeight-n.clientHeight)/4*3&&this.nextPage==null&&this.preloadNextPage();!this.isPreloadingPrevious&&this.enablePreload&&n.scrollTop<(n.scrollHeight-n.clientHeight)/4&&this.previousPage==null&&this.preloadPreviousPage();this.totalItemsCount>this.firstVisibleItemIndex+this.visibleItems.length&&n.scrollTop+n.clientHeight>=n.scrollHeight-10&&this.showNextPage();this.firstVisibleItemIndex>0&&n.scrollTop<=10&&this.showPreviousPage();this.isDesktopMode()&&this.updateGlobalScroll()},t.prototype.updateGlobalScroll=function(){var i=this,n,r,t,u,f;if(this.tableBodyContainer.scrollTop==this.tableBodyContainer.scrollHeight-this.tableBodyContainer.clientHeight&&this.firstVisibleItemIndex+this.visibleItems.length==this.totalItemsCount){this.scrollBar.onscroll=null;this.scrollBar.scrollTop=this.scrollBar.scrollHeight-this.scrollBar.clientHeight;this.scrollBar.onscroll=function(){i.scrollBar.onscroll=function(){return i.onManualScroll()}};return}if(n=this.htmlProvider.getFirstVisibleItem(this.tableBody,this.visibleViewModels,this.tableBodyContainer.scrollTop),n.isGroupHeader&&(n=this.getFirstItemInGroup(n)),n!=null){for(r=this.firstVisibleItemIndex,t=0;t<this.visibleItems.length;t++)if(n.item==this.visibleItems[t]){r=this.firstVisibleItemIndex+t;break}this.scrollBar.onscroll=null;u=this.htmlProvider.getVisibleItemsCount(this.tableBody,this.tableBodyContainer,this.tableBodyContainer.scrollTop,!0);f=(this.scrollBar.scrollHeight-this.scrollBar.clientHeight)/(this.totalItemsCount-u)*r+10;this.scrollBar.scrollTop=f;this.scrollBar.onscroll=function(){i.scrollBar.onscroll=function(){return i.onManualScroll()}}}},t.prototype.getFirstItemInGroup=function(n){for(var t=0;t<this.visibleViewModels.length;t++)if(this.visibleViewModels[t]==n)for(;t<this.visibleViewModels.length;t++)if(!this.visibleViewModels[t].isGroupHeader)return this.visibleViewModels[t];return null},t.prototype.updateGlobalScrollMobile=function(){var t=this,i,r,n,u,f;if(this.mobileContainer.scrollTop==this.mobileContainer.scrollHeight-this.mobileContainer.clientHeight&&this.firstVisibleItemIndex+this.visibleItems.length==this.totalItemsCount){this.scrollBar.onscroll=null;this.scrollBar.scrollTop=this.scrollBar.scrollHeight-this.scrollBar.clientHeight;this.scrollBar.onscroll=function(){t.scrollBar.onscroll=function(){return t.onManualScroll()}};return}if(i=this.htmlProvider.getFirstVisibleItem(this.mobileContainer,this.visibleViewModels,this.mobileContainer.scrollTop),i!=null){for(r=this.firstVisibleItemIndex,n=0;n<this.visibleItems.length;n++)if(i.item==this.visibleItems[n]){r=this.firstVisibleItemIndex+n;break}u=this.htmlProvider.getVisibleItemsCount(this.mobileContainer,this.mobileContainer,this.mobileContainer.scrollTop,!0);f=(this.scrollBar.scrollHeight-this.scrollBar.clientHeight)/(this.totalItemsCount-u)*r;this.scrollBar.onscroll=null;this.scrollBar.scrollTop=f;this.scrollBar.onscroll=function(){t.scrollBar.onscroll=function(){return t.onManualScroll()}}}},t.prototype.onManualScroll=function(){var n=this;this.manualScrollTimeoutToken!=null&&clearTimeout(this.manualScrollTimeoutToken);this.manualScrollTimeoutToken=setTimeout(function(){var i,r,t,u;n.manualScrollTimeoutToken=null;i=n.isDesktopMode()?n.htmlProvider.getVisibleItemsCount(n.tableBody,n.tableBodyContainer,n.tableBodyContainer.scrollTop,!0):n.htmlProvider.getVisibleItemsCount(n.mobileContainer,n.mobileContainer,n.mobileContainer.scrollTop,!0);r=(n.scrollBar.scrollHeight-n.scrollBar.clientHeight)/(n.totalItemsCount-i);t=n.scrollBar.scrollTop/r;n.showBuisyIndicator();n.previousPage=null;n.nextPage=null;u=!1;n.itemProvider.getItems(t,n.options.firstLoadSize,n.getEffectiveSorting(),n.getEffectiveFiltering(),n.getCollapsedGroupFilter(),function(i,r){t==0?n.scrollTableContainer(0):n.scrollTableContainer(48);n.firstVisibleItemIndex=r;n.visibleItems=i;n.visibleViewModels=n.buildViewModels(n.visibleItems);n.updateVisibleItems();n.hideBuisyIndicator()})},400)},t.prototype.preloadPreviousPage=function(){var n=this,t=this.getPreviousPageSize();t>0&&(this.isPreloadingPrevious=!0,this.itemProvider.getItems(this.getPreviousPageFirsItemIndex(),t,this.getEffectiveSorting(),this.getEffectiveFiltering(),this.getCollapsedGroupFilter(),function(t){n.previousPage=t;n.isPreloadingPrevious=!1}))},t.prototype.preloadNextPage=function(){var n=this;this.isPreloadingNext=!0;this.itemProvider.getItems(this.getNextPageFirstItemIndex(),this.getNextPageSize(),this.getEffectiveSorting(),this.getEffectiveFiltering(),this.getCollapsedGroupFilter(),function(t){n.nextPage=t;n.isPreloadingNext=!1})},t.prototype.showPreviousPage=function(){var u=this,i,t,n,r;if(this.previousPage==null){if(this.firstVisibleItemIndex==0){this.hideBuisyIndicator();return}this.showBuisyIndicator();this.isPreloadingPrevious||this.preloadPreviousPage();setTimeout(function(){u.showPreviousPage()},10)}else if(this.previousPage!=null&&this.previousPage.length>0){for(this.hideBuisyIndicator(),this.enablePreload=!1,this.visibleItems.splice(this.visibleItems.length-this.options.batchSize,this.options.batchSize),this.firstVisibleItemIndex-=this.options.batchSize,this.firstVisibleItemIndex<0&&(this.firstVisibleItemIndex=0),i=this.previousPage[this.previousPage.length-1],this.visibleItems=this.previousPage.concat(this.visibleItems),this.visibleViewModels=this.buildViewModels(this.visibleItems),this.updateVisibleItems(),t=[],n=0;n<this.visibleViewModels.length;n++)if(t.push(this.visibleViewModels[n]),this.visibleViewModels[n].item==i)break;r=this.htmlProvider.getElementsSize(this.tableBody,t);this.scrollTableContainer(r);this.previousPage=null;this.nextPage=null;this.enablePreload=!0;this.rootElement.focus()}},t.prototype.showNextPage=function(){var o=this,t,u,i,f,r,n,e;if(this.nextPage==null){if(this.totalItemsCount<=this.firstVisibleItemIndex+this.visibleItems.length){this.hideBuisyIndicator();return}this.showBuisyIndicator();this.isPreloadingNext||this.preloadNextPage();setTimeout(function(){o.showNextPage()},10)}else if(this.nextPage!=null&&this.nextPage.length>0){for(this.hideBuisyIndicator(),this.enablePreload=!1,t=this.isDesktopMode()?this.htmlProvider.getFirstVisibleItem(this.tableBody,this.visibleViewModels,this.tableBodyContainer.scrollTop):this.htmlProvider.getFirstVisibleItem(this.mobileContainer,this.visibleViewModels,this.mobileContainer.scrollTop),u=0,n=0;n<this.visibleItems.length;n++)if(t.item==this.visibleItems[n]){u=n;break}for(i=u-this.options.batchSize,i>0&&(this.visibleItems.splice(0,i),this.firstVisibleItemIndex+=i),f=t,n=0;n<this.visibleItems.length-1;n++)if(t.item==this.visibleItems[n]){f=this.visibleItems[n+1];break}for(this.visibleItems=this.visibleItems.concat(this.nextPage),this.visibleViewModels=this.buildViewModels(this.visibleItems),this.updateVisibleItems(),r=[],n=0;n<this.visibleViewModels.length;n++)if(r.push(this.visibleViewModels[n]),this.visibleViewModels[n].item==f)break;e=this.isDesktopMode()?this.htmlProvider.getElementsSize(this.tableBody,r):this.htmlProvider.getElementsSize(this.mobileContainer,r);this.scrollTableContainer(e);this.nextPage=null;this.previousPage=null;this.enablePreload=!0;this.rootElement.focus()}},t.prototype.scrollTableContainer=function(n){this.tableBodyContainer.scrollTop=n;this.mobileContainer.scrollTop=n<=0?2:n},t.prototype.silentScrollTableContainer=function(n){var t=this;this.tableBodyContainer.onscroll=null;this.mobileContainer.onscroll=null;this.tableBodyContainer.scrollTop=n;this.mobileContainer.scrollTop=n<=0?2:n;setTimeout(function(){t.tableBodyContainer.onscroll=function(){return t.scrollTable()};t.mobileContainer.onscroll=function(){return t.scrollTable()}},10)},t.prototype.addGroupDescriptor=function(t,i){this.options.groupBySortDescriptors.push(new n.SortDescriptor(t,i));this.refreshHeader();this.refreshBody()},t.prototype.toggleGroupDescriptor=function(n){for(var t=0;t<this.options.groupBySortDescriptors.length;t++)if(this.options.groupBySortDescriptors[t].path==n){this.removeGroupDescriptor(n);return}this.addGroupDescriptor(n,!0)},t.prototype.removeGroupDescriptor=function(n){for(var i,r,t=0;t<this.options.groupBySortDescriptors.length;t++)if(this.options.groupBySortDescriptors[t].path==n){this.options.groupBySortDescriptors.splice(t,1);break}for(i=!0;i;)for(i=!1,t=0;!i&&t<this.collapsedGroupFilterDescriptors.length;t++)for(r=0;!i&&r<this.collapsedGroupFilterDescriptors[t].children.length;r++)this.collapsedGroupFilterDescriptors[t].children[r].path==n&&(this.collapsedGroupFilterDescriptors.splice(t,1),i=!0);this.refreshHeader();this.refreshBody()},t.prototype.showFilterPopup=function(n,t,i,r){this.options.filterPopupForColumn=n;this.filterPopupViewModel.onOpen(this.options,n);r&&(this.filterPopUp.style.left=t.toString()+"px",this.filterPopUp.style.top=i.toString()+"px");unhideElement(this.filterPopUp)},t.prototype.hideFilterPopup=function(){hideElement(this.filterPopUp)},t.prototype.sortBy=function(n){n!=null&&(n==this.options.sortDescriptor.path?this.options.sortDescriptor.asc?this.options.sortDescriptor.asc=!this.options.sortDescriptor.asc:(this.options.sortDescriptor.path=null,this.options.sortDescriptor.asc=null):(this.options.sortDescriptor.path=n,this.options.sortDescriptor.asc=!0));this.refreshHeader();this.refreshBody()},t.prototype.mobileSortBy=function(t,i){i!=null?(this.options.sortDescriptor.path=t,this.options.sortDescriptor.asc=i):this.options.sortDescriptor=new n.SortDescriptor(null,null);this.refreshHeader();this.refreshBody()},t.prototype.selectPage=function(n){this.options.currentPage=n;this.refreshHeader();this.refreshBody();this.refreshFooter()},t.prototype.selectItem=function(t,i){for(var u=[],r=0;r<this.options.selection.length;r++)u.push(this.options.selection[r]);for(this.options.selectionMode==2?i?this.options.isSelected(t.item)?this.options.selection.splice(r,1):this.options.selection.push(t.item):this.options.selection=[t.item]:this.options.selectionMode==1?(this.options.shouldAddDetailsOnSelection=this.options.selection[0]==t.item&&this.options.shouldAddDetailsOnSelection?!1:!0,this.options.selection=[t.item]):this.options.selection=[],this.options.openDetailsOnSelection?this.options.selection.length==1&&(this.options.showDetailFor=new n.ShowDetail,this.options.showDetailFor.item=this.options.selection[0]):this.options.showDetailFor=new n.ShowDetail,r=0;r<u.length;r++)this.updateRow(u[r],this.options.shouldAddDetailsOnSelection);for(r=0;r<this.options.selection.length;r++)this.updateRow(this.options.selection[r],this.options.shouldAddDetailsOnSelection);return this.scrollIntoView(t.item),this.updateFooterViewModel(),!0},t.prototype.scrollIntoView=function(n){var u=[],r=this.htmlProvider.getVisibleItemsCount(this.tableBody,this.tableBodyContainer,this.tableBodyContainer.scrollTop,!1),e=this.htmlProvider.getFirstVisibleItem(this.tableBody,this.visibleViewModels,this.tableBodyContainer.scrollTop),i,t,f;for(r--,i=!1,t=0;t<this.visibleViewModels.length;t++){if(t>0&&e==this.visibleViewModels[t-1]&&(i=!0),i&&r--,r<=0&&(i=!1),this.visibleViewModels[t].item==n){if(i)return;break}u.push(this.visibleViewModels[t])}f=this.htmlProvider.getElementsSize(this.tableBody,u);this.tableBodyContainer.scrollTop=f},t.prototype.updateRow=function(n,t){this.htmlProvider.updateTableDetailRow(this.options,this.tableBodyContainer.getElementsByTagName("tbody")[0],n,t);this.htmlProvider.updateMobileDetailRow(this.options,this.mobileContainer,n,t)},t.prototype.buildViewModels=function(t){for(var f,o,e,c,s,r,h=[],u=[],l=[],i=0;i<this.options.groupBySortDescriptors.length;i++)u.push(""),l.push(!1);for(f=!1,o=this.options.groupBySortDescriptors.length,e=0;e<t.length;e++){for(i=0;i<o;i++)if(c=getMemberValue(t[e],this.options.groupBySortDescriptors[i].path),u[i]!==c){for(u[i]=c,f=!1,o=this.options.groupBySortDescriptors.length,s=new n.FilterDescriptor("","",0,0,0),r=0;r<=i;r++)s.children.push(new n.FilterDescriptor(this.options.groupBySortDescriptors[r].path,u[r],1));for(f=this.isGroupCollapsedOrInsideCollapsed(s),h.push(new n.ItemViewModel(this.options.parentViewModel,new n.GroupHeaderDescriptor(u[i],i,f,s),this,!0)),r=i+1;r<this.options.groupBySortDescriptors.length;r++)u[r]="";if(f){o=i+1;break}}f||h.push(new n.ItemViewModel(this.options.parentViewModel,t[e],this,!1))}return h},t.prototype.isEqualOrDeeperThanCollapsedFilter=function(n,t){if(t.children.length>=n.children.length){for(var i=0;i<n.children.length;i++)if(t.children[i].path!==n.children[i].path||t.children[i].value!==n.children[i].value)return!1;return!0}return!1},t.prototype.isGroupCollapsedOrInsideCollapsed=function(n){for(var t=0;t<this.collapsedGroupFilterDescriptors.length;t++)if(this.isEqualOrDeeperThanCollapsedFilter(this.collapsedGroupFilterDescriptors[t],n))return!0;return!1},t.prototype.updateVisibleItems=function(){var n=this;this.tableBody.innerHTML="";this.tableBody=this.htmlProvider.updateTableBodyElement(this.options,this.tableBody,this.visibleViewModels,function(t,i){return n.selectItem(t,i)});this.htmlProvider.updateColumnWidth(this.options,this.tableHeader,this.tableBody,this.tableFooter);this.mobileContainer.innerHTML="";this.htmlProvider.updateMobileItemsList(this.options,this.mobileContainer,this.visibleViewModels,function(t,i){return n.selectItem(t,i)})},t.prototype.getHtmlProvider=function(t){return t.framework==0?new n.KnockoutHtmlProvider:t.framework==1?new n.AngularHtmlProvider:void 0},t.prototype.getFirstItemNumber=function(){return this.options.pageSize*this.options.currentPage},t.prototype.getPageSize=function(){return this.options.pageSize},t.prototype.refreshHeader=function(){var n=this;this.options.hideHeader||(this.options.enableGrouping?unhideElement(this.groupByElement):hideElement(this.groupByElement),this.htmlProvider.updateTableHeadElement(this.options,this.tableHeader,this.groupByElement,this.filterPopUp,function(t){return n.columnsResized(t)}),this.refreshMobileHeader())},t.prototype.updateBody=function(){this.refreshBody()},t.prototype.refreshBody=function(n){var t=this;typeof n=="undefined"&&(n=!1);n&&this.showBuisyIndicator();this.options.enablePaging?this.itemProvider.getTotalItemsCount(this.getEffectiveFiltering(),function(i){t.totalItemsCount=i;t.itemProvider.getItems(t.getFirstItemNumber(),t.getPageSize(),t.getEffectiveSorting(),t.getEffectiveFiltering(),t.getCollapsedGroupFilter(),function(i,r){t.firstVisibleItemIndex=r;t.visibleItems=i;t.visibleViewModels=t.buildViewModels(t.visibleItems);t.updateVisibleItems();t.updateFooterViewModel();n&&t.hideBuisyIndicator();t.onReady()})}):this.itemProvider.getTotalItemsCount(this.getEffectiveFiltering(),function(i){t.totalItemsCount=i;t.itemProvider.getItems(t.getFirstItemNumber(),t.options.firstLoadSize,t.getEffectiveSorting(),t.getEffectiveFiltering(),t.getCollapsedGroupFilter(),function(i,r){t.firstVisibleItemIndex=r;t.visibleItems=i;t.visibleViewModels=t.buildViewModels(t.visibleItems);t.updateVisibleItems();t.updateFooterViewModel();n&&t.hideBuisyIndicator();var u=t.isDesktopMode()?t.htmlProvider.getElementsSize(t.tableBody,null):t.htmlProvider.getElementsSize(t.mobileContainer,null);u>0&&t.options.firstLoadSize>0&&isNotNoU(t.options.firstLoadSize)?t.isDesktopMode()&&u<t.tableBodyContainer.clientHeight+100&&t.options.firstLoadSize<t.totalItemsCount?(t.options.firstLoadSize*=2,t.options.firstLoadSize>t.totalItemsCount&&(t.options.firstLoadSize=t.totalItemsCount),t.refreshBody()):!t.isDesktopMode()&&t.htmlProvider.getElementsSize(t.mobileContainer,null)<t.mobileContainer.clientHeight+100&&t.options.firstLoadSize<t.totalItemsCount?(t.options.firstLoadSize*=2,t.options.firstLoadSize>t.totalItemsCount&&(t.options.firstLoadSize=t.totalItemsCount),t.refreshBody()):t.onReady():t.onReady()})})},t.prototype.onReady=function(){this.isFirstRefresh&&(isNotNoU(this.options.ready)&&(this.isFirstRefresh=!1,this.options.ready(this.options)),this.isFirstRefresh=!1)},t.prototype.refreshFooter=function(){this.htmlProvider.updateTableFooterElement(this.options,this.tableFooter,this.totalItemsCount,this.footerViewModel)},t.prototype.updateFooterViewModel=function(){this.footerViewModel!=null&&(this.footerViewModel.setCurrentPage(this.options.currentPage+1),this.footerViewModel.setSelectedItem(this.options.selection[0]),this.footerViewModel.setTotalCount(this.totalItemsCount),this.options.enablePaging?this.footerViewModel.setTotalPages(Math.ceil(this.totalItemsCount/this.options.pageSize)):this.footerViewModel.setTotalPages(1))},t.prototype.showBuisyIndicator=function(){this.isBuisy=!0;this.buisyIndicator.removeAttribute("style")},t.prototype.hideBuisyIndicator=function(){this.buisyIndicator.setAttribute("style","display: none;");this.isBuisy=!1},t.prototype.setCollapsedFilters=function(n){this.collapsedGroupFilterDescriptors.push(n);this.refreshBody()},t.prototype.removeCollapsedFilters=function(n){for(var t=0;t<this.collapsedGroupFilterDescriptors.length;t++)this.isEqualOrDeeperThanCollapsedFilter(this.collapsedGroupFilterDescriptors[t],n)&&this.collapsedGroupFilterDescriptors.splice(t,1);this.refreshBody()},t.prototype.applyFilters=function(){this.refreshHeader();this.refreshBody();this.refreshFooter()},t.prototype.refreshMobileHeader=function(){this.htmlProvider.updateMobileHeadElement(this.options,this.mobileHeader,this.filterPopUp)},t.prototype.afterOptionsChange=function(){var n=this,t;this.rootElement.onmousewheel=this.options.captureScroll?undefined:function(t){return n.mouseWheel(t)};this.options.enableFiltering&&isNoU(this.rootElement.getElementsByClassName("tgrid-filter-popup")[0])&&(this.filterPopUp=document.createElement("div"),this.filterPopUp.setAttribute("class","tgrid-filter-popup"),this.filterPopUp.style.display="none",this.rootElement.appendChild(this.filterPopUp),this.filterPopupViewModel=this.htmlProvider.getFilterPopupViewModel(this.filterPopUp),this.htmlProvider.updateFilteringPopUp(this.options,this.filterPopUp,this.filterPopupViewModel));this.options.enableVirtualScroll&&isNoU(this.rootElement.getElementsByClassName("tgrid-scroll")[0])&&(this.scrollBar=document.createElement("div"),this.scrollBar.className=this.options.hideHeader?"tgrid-scroll noheader":"tgrid-scroll",this.scrollBar.style.overflowX="hidden",this.scrollBar.style.overflowY="scroll",t=document.createElement("div"),t.style.height="10000px",t.style.width="1px",this.scrollBar.appendChild(t),this.bodyAndHeaderContainer.appendChild(this.scrollBar),this.scrollBar.onscroll=function(){return n.onManualScroll()},this.tableBodyContainer.onscroll=function(){return n.scrollTable()},this.mobileContainer.onscroll=function(){return n.scrollTable()});!this.options.enableVirtualScroll&&isNotNoU(this.rootElement.getElementsByClassName("tgrid-scroll")[0])&&(this.rootElement.getElementsByClassName("tgrid-scroll")[0].parentNode.removeChild(this.rootElement.getElementsByClassName("tgrid-scroll")[0]),this.tableBodyContainer.onscroll=null,this.mobileContainer.onscroll=null,this.itemProvider.getTotalItemsCount(this.options.filterDescriptor,function(t){n.options.firstLoadSize=t}));this.refreshHeader();this.refreshBody(this.options.enableVirtualScroll);this.refreshFooter()},t.prototype.setColumnsFromItemsProvider=function(){var r=this.itemProvider.getFirstItem(),i,t;if(r!=null)for(i in r)t=new n.ColumnInfo,t.member=i,t.sortMemberPath=i,t.groupMemberPath=i,t.filterMemberPath=i,this.options.columns.push(t)},t}();n.Grid=t})(n.TGrid||(n.TGrid={}));var t=n.TGrid}(TesserisPro||(TesserisPro={}))